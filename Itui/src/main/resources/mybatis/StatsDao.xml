<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.itui.webdevelop.dao.StatsDao">
    <update id="refreshStats" parameterType="string">
		UPDATE
		      pv_stats 
		SET times= times+1 
		WHERE date=#{date}
	</update>
	
	<select id="getUserNum" resultType="int">
	    SELECT
	          COUNT(user.id) as user_num
	    FROM
	          user
	</select>
	
	<select id="getLastRecordDate" resultType="string">
	    SELECT
	          pv_stats.date as date
	    FROM
	          pv_stats
	    ORDER BY pv_stats.date DESC LIMIT 1
	</select>
	
	<insert id="creatNewRecord" parameterType="string">
	    INSERT INTO
	          pv_stats
	    VALUES(#{date},1,1)    
	</insert>
	
	<select id="getTodayStatsInfo" parameterType="string" resultType="java.util.HashMap">
	    SELECT
	          pv_stats.date as date,
	          pv_stats.times as today
	    FROM
	          pv_stats
	    WHERE
	          pv_stats.date=#{date}
	</select>
	
	<select id="getTotalPV" resultType="int">
	    SELECT
	          SUM(pv_stats.times) as total
	    FROM
	          pv_stats
	</select>
</mapper>